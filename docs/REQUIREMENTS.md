# Enterprise NotebookLM for ERP - 需求规格说明书 v2.0

## 1. 项目概述

### 1.1 项目背景
Enterprise NotebookLM for ERP 是一个面向企业管理人员的智能 BI 助手平台，旨在接入企业内部 ERP 系统，为管理层提供基于企业指标体系的报表和报告生成服务。

### 1.2 目标用户
| 用户角色 | 职责描述 | 核心需求 |
|---------|---------|---------|
| **Data Scientist** | 数据分析与建模 | 预测、拟合、分类、特征提取等高级分析工具 |
| **Business Administrator** | 业务管理与决策 | 快速获取标准报表、KPI 监控、生成报告 |

> **注意**: 本版本不再面向 Data Engineer，淡化数据库直连功能

### 1.3 核心价值
- 统一企业指标体系，确保数据口径一致
- 简化报表获取流程，降低技术门槛
- AI 驱动的智能分析与报告生成
- **多源数据集成**，支持报表+IM+文件+Web的智能融合
- 多模型支持，满足不同场景需求

---

## 2. 功能需求

### 2.1 数据源管理（左侧面板）

#### 2.1.1 数据源分类（四大Tab）

采用**方形按钮**样式，上方文字+下方图标：

```
┌────────────────────────────────────────┐
│  ┌─────────┐ ┌─────────┐ ┌─────────┐  │
│  │  Query  │ │   IM    │ │  离线   │  │
│  │   🔗    │ │   💬    │ │   📁    │  │
│  └─────────┘ └─────────┘ └─────────┘  │
└────────────────────────────────────────┘
```

| Tab | 说明 | 内容 |
|-----|------|------|
| **Query** | 查询与指标 | 数据库定制、指标体系、集成记录 |
| **IM** | 即时通讯 | 飞书、企业微信、邮件（微信合并消息形式） |
| **离线** | 上传文件 | CSV, Excel, PDF等（点击显示摘要+标签） |

#### 2.1.2 Query Tab（三个子分类）

```
Query Tab
├── 1️⃣ 数据库定制 (DB Link)
│   └── 链接外部数据库，自定义SQL查询
├── 2️⃣ 指标体系浏览 (Metrics Browser)
│   ├── 标准报表 (7类)
│   ├── KPI 指标 (5类)
│   ├── 预测报表 (5类)
│   ├── 模块报表 (7类)
│   └── 分析洞察 (8类)
└── 3️⃣ 集成记录 (Integration Records)
    └── 用户确认的集成报表记录
```

**指标体系详细结构：**

| 一级分类 | 二级分类 | 说明 |
|---------|---------|------|
| **标准报表** | 财务、应收、应付、库存、CRM、生产、费用 | ERP核心报表 |
| **KPI指标** | 财务类、销售预测类、库存供应链类、客服类、员工项目类 | 关键绩效指标 |
| **预测报表** | 销售、财务现金流、需求供应链、项目、计划预算 | 前瞻性分析 |
| **模块报表** | GL总账、AP应付、AR应收、固定资产、采购、库存、项目管理 | 模块级明细 |
| **分析洞察** | 盈利性、流动性、采购支出、收入保障、项目资源、审计合规等 | AI洞察分析 |

**点击指标时显示：**
- 📋 报表描述
- 🔗 数据来源
- 💡 可修改和增强方向

#### 2.1.3 IM Tab（微信合并消息形式）

数据以**合并消息**形式呈现：
```
┌─────────────────────────────────┐
│ 👤 张三 - 财务部               │
│ ─────────────────────────────── │
│ 讨论内容摘要...                │
│ 📎 附件: Q3报表.xlsx           │
│ 🕐 2024-01-07 14:30            │
└─────────────────────────────────┘
```

| 字段 | 说明 |
|------|------|
| 来源人 | 发送者姓名+部门 |
| 讨论内容 | 消息摘要 |
| 内置文件 | 附件列表 |
| 时间 | 发送时间 |

**点击记录时显示：** 摘要 + 标签

#### 2.1.4 离线 Tab（上传文件）

| 功能 | 说明 |
|------|------|
| 上传 | 支持拖拽上传 CSV, Excel, JSON, PDF, Word, 图片 |
| 预览 | 点击文件显示 **摘要** 和 **标签** |
| OCR | 图片自动 OCR 识别 |

---

### 2.2 多源数据集成（核心新功能）

#### 2.2.1 集成流程

```
选择多个数据源 → 点击「集成」按钮 → Agent自动分析 → 生成集成报表 → 显示在中间栏
                                        ↓
                                  用户可讨论修改
                                        ↓
                                  确认后存入右侧栏
                                        ↓
                                  可拖拽到Query记录
```

#### 2.2.2 可集成的数据类型

| 类型 | 来源 | 说明 |
|------|------|------|
| 📊 报表 | 指标体系 | ERP标准报表、KPI等 |
| 💬 IM数据 | 飞书/微信/邮件 | 沟通记录中的数据 |
| 📁 离线文件 | 用户上传 | CSV, Excel等 |
| 🌐 Web数据 | 用户指定URL | 网页抓取数据 |

#### 2.2.3 集成报表特性

Agent 自动完成：
1. **列/行分析**：分析各数据源的列名和行数据
2. **智能匹配**：识别相同/相似字段进行关联
3. **生成标签**：自动生成描述性标签
4. **配图表**：根据数据类型生成合适的图表

#### 2.2.4 集成记录结构

存入 Query Tab 的集成记录包含：
| 字段 | 说明 |
|------|------|
| 简介 | 集成报表的描述 |
| 数据来源 | 包含哪些表/文件/IM |
| 集成方式 | 如何关联的说明 |
| 创建者 | 谁创建的 |
| 标签 | 自动+手动标签 |
| 时间 | 创建时间 |

---

### 2.3 对话交互（中间面板）

#### 2.3.1 AI 对话
- 自然语言查询数据
- 智能解析用户意图
- 上下文记忆与多轮对话
- 中英文混合输入支持

#### 2.3.2 集成报表显示

集成报表在中间栏显示，包含：
- 📊 数据表格
- 📈 自动图表
- 🏷️ 标签列表
- 💬 可讨论修改

#### 2.3.3 工具栏（底部）

| 工具 | 图标 | 功能 | 状态规则 |
|------|------|------|---------|
| **上传** | 📎 | 文件上传 | 始终可用 |
| **Web Link** | 🔗 | URL 导入 | 始终可用 |
| **预测** | 📈 | 时间序列预测 | **选中报表时高亮可点** |
| **拟合** | 📉 | 曲线拟合 | **选中报表时高亮可点** |
| **分类** | 🏷️ | 数据分类 | **选中报表时高亮可点** |
| **特征提取** | ✨ | 特征工程 | **选中报表时高亮可点** |

> **交互规则**：当用户在左侧选择报表或在中间栏有集成报表时，预测/拟合/分类/特征提取按钮高亮可点击，点击后在中间栏生成对应分析图表。

#### 2.3.4 模型选择器

| 模型 | 提供商 | 特点 |
|------|--------|------|
| **Gemini** | Google | 多模态、长上下文 |
| **Claude** | Anthropic | 推理强、安全性高 |
| **GPT** | OpenAI | 通用性强 |
| **DeepSeek** | DeepSeek | 代码能力强、成本低 |
| **Qwen** | 阿里云 | 中文优化 |
| **GLM** | 智谱 | 国产可控 |

#### 2.3.5 AI 模型配置（重要）

**默认模型配置 - 请勿修改：**

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **API Key** | `AIzaSyCt7PZfa7OH2PkNoMGQQ6PQGwVybqlK3EE` | 硬编码，不从环境变量读取 |
| **模型** | `gemini-3-pro-preview` | Gemini 3 Pro 模型 |
| **SDK** | `@google/generative-ai` | Google Generative AI SDK |

> **重要**: 此配置为项目固定配置，所有 AI 分析功能（文件分析、对话、摘要生成）必须使用此配置。实现时必须硬编码，不得从环境变量或配置文件读取。

---

### 2.4 工作交付管理（右侧面板 - Studio）

#### 2.4.1 内容生成工具

| 类型 | 输出格式 | 说明 |
|------|---------|------|
| **报告 (Report)** | Markdown, PDF | 深度分析报告 |
| **简报 (Brief)** | 单页 PDF | 一页纸摘要 |
| **演示文稿 (PPT)** | PPTX | 汇报用演示 |
| **数据导出** | CSV, Excel | 原始数据下载 |

#### 2.4.2 集成报表交付件

用户确认的集成报表显示在右侧栏：
- 作为**工作交付件**管理
- 可点击查看详情
- 支持**拖拽到左侧 Query Tab** 存为记录

#### 2.4.3 拖拽交互

```
右侧栏集成报表 ──拖拽──> 左侧 Query Tab 集成记录区
```

拖拽后自动：
1. 保存到集成记录
2. 生成完整元数据（来源、方式、创建者等）
3. 添加标签

---

## 3. UI/UX 设计规范

### 3.1 整体风格
- **主题**: Dark Mode（深色模式）
- **配色方案**:
  - 背景色: `#0f0f0f` (主背景) / `#1a1a1a` (面板背景)
  - 文字色: `#ffffff` (主文字) / `#a0a0a0` (次要文字)
  - 强调色: `#3b82f6` (蓝色) / `#10b981` (绿色) / `#f59e0b` (橙色)
  - 边框色: `#2a2a2a`
- **字体**: Inter / PingFang SC

### 3.2 左侧面板设计

#### 方形Tab按钮
```css
.tab-button {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 12px 16px;
  border-radius: 8px;
  /* 上方文字，下方图标 */
}
```

#### 指标详情面板
```
┌─────────────────────────────────┐
│ 📊 资产负债表                    │
├─────────────────────────────────┤
│ 📋 描述                         │
│ 核心财务报表，展示企业资产、    │
│ 负债和股东权益的构成情况        │
├─────────────────────────────────┤
│ 🔗 数据来源                     │
│ ERP > GL模块 > 财务报表         │
├─────────────────────────────────┤
│ 💡 可增强方向                   │
│ • 添加同比/环比分析             │
│ • 关联现金流量表                │
│ • 生成趋势预测                  │
├─────────────────────────────────┤
│ [选择] [集成]                   │
└─────────────────────────────────┘
```

### 3.3 中间面板设计

#### 集成报表展示
```
┌─────────────────────────────────────────┐
│ 📊 集成报表：Q3财务+销售综合分析         │
├─────────────────────────────────────────┤
│ 🏷️ 标签：财务 | 销售 | Q3 | 综合分析    │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │      [数据表格]                      │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │      [自动图表]                      │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💬 关于这个报表有什么问题？              │
└─────────────────────────────────────────┘
```

### 3.4 交互状态

#### 工具栏按钮状态
| 状态 | 样式 | 触发条件 |
|------|------|---------|
| 禁用 | 灰色、不可点击 | 未选择任何报表 |
| 高亮 | 彩色、可点击 | 选中左侧报表或中间有集成报表 |
| 激活 | 深色背景 | 正在执行分析 |

### 3.5 三栏布局更新

```
┌────────────────────────────────────────────────────────────────────┐
│  🏢 Enterprise NotebookLM for ERP          [Model: Gemini ▼] [👤] │
├────────────┬─────────────────────────────────┬─────────────────────┤
│            │                                 │                     │
│  [Query]   │   📊 集成报表                   │     STUDIO          │
│  [IM]      │   ┌───────────────────────┐    │                     │
│  [离线]    │   │ 🏷️ 财务|销售|Q3      │    │  ┌───────────────┐  │
│            │   ├───────────────────────┤    │  │ Report        │  │
│ ─ Query ─  │   │    [表格数据]          │    │  │ Brief         │  │
│ 1.DB定制   │   │    [图表]             │    │  │ PPT           │  │
│ 2.指标体系  │   └───────────────────────┘    │  │ Export        │  │
│   └─标准报表│                                 │  └───────────────┘  │
│   └─KPI    │   ┌───────────────────────┐    │                     │
│   └─预测   │   │ AI 对话...            │    │  ── 交付件 ──       │
│ 3.集成记录  │   └───────────────────────┘    │  📊 Q3综合分析      │
│            │                                 │  📊 销售预测报表     │
│ ─ IM ─     │   ┌───────────────────────┐    │                     │
│ 👤张三-财务 │   │ 输入问题...            │    │  [可拖拽到左侧]     │
│ 👤李四-销售 │   └───────────────────────┘    │                     │
│            │                                 │                     │
│            │   [📎][🔗][📈][📉][🏷️][✨]     │                     │
│            │          ↑ 选中报表时高亮        │                     │
└────────────┴─────────────────────────────────┴─────────────────────┘
```

---

## 4. 交互流程

### 4.1 多源集成流程

```
1. 用户选择多个数据源（勾选报表/IM/文件）
       ↓
2. 点击「集成」按钮
       ↓
3. Agent 分析各数据源的列和行值
       ↓
4. 自动生成集成报表（表格+图表+标签）
       ↓
5. 显示在中间栏，用户可讨论修改
       ↓
6. 用户确认 → 存入右侧栏交付件
       ↓
7. 可拖拽到左侧 Query 集成记录
```

### 4.2 分析工具使用流程

```
1. 用户选择左侧报表 或 中间有集成报表
       ↓
2. 底部工具栏（预测/拟合/分类/特征）高亮
       ↓
3. 点击工具按钮
       ↓
4. Agent 执行分析
       ↓
5. 在中间栏生成分析图表
```

### 4.3 IM数据使用流程

```
1. 点击 IM Tab
       ↓
2. 显示合并消息列表
       ↓
3. 点击某条消息
       ↓
4. 下方显示摘要和标签
       ↓
5. 可选择加入集成
```

---

## 5. 技术架构

### 5.1 前端技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18.x | UI 框架 |
| TypeScript | 5.x | 类型安全 |
| Vite | 5.x | 构建工具 |
| Tailwind CSS | 3.x | 样式框架（Dark Mode） |
| Zustand | 4.x | 状态管理 |
| React DnD | 16.x | 拖拽功能 |
| Lucide React | - | 图标库 |
| Recharts | 2.x | 图表组件 |

### 5.2 关键组件

| 组件 | 功能 |
|------|------|
| `DataSourcePanel` | 左侧数据源面板（三Tab） |
| `QueryTab` | Query子面板（DB/指标/集成记录） |
| `MetricsBrowser` | 指标体系浏览器 |
| `MetricDetailPanel` | 指标详情面板 |
| `IMMessageList` | IM消息列表（合并形式） |
| `OfflineFileList` | 离线文件列表 |
| `IntegrationPanel` | 集成报表展示 |
| `ChatPanel` | 对话面板 |
| `AnalysisToolbar` | 分析工具栏（动态高亮） |
| `StudioPanel` | 右侧工作区 |
| `DeliverableList` | 交付件列表（支持拖拽） |

---

## 6. 里程碑规划

### Phase 1: UI 原型重构（当前）
- [x] Dark Mode UI 重构
- [ ] 左侧栏：方形Tab按钮样式
- [ ] 左侧栏：Query三分类（DB/指标/集成记录）
- [ ] 左侧栏：指标详情面板
- [ ] 左侧栏：IM合并消息形式
- [ ] 左侧栏：离线文件摘要+标签
- [ ] 中间栏：集成报表展示
- [ ] 中间栏：工具栏动态高亮
- [ ] 右侧栏：交付件管理
- [ ] 右侧栏：拖拽到左侧Query

### Phase 2: 集成功能
- [ ] 多源数据选择
- [ ] Agent智能集成
- [ ] 自动标签生成
- [ ] 自动图表生成

### Phase 3: 分析工具
- [ ] 预测功能实现
- [ ] 拟合功能实现
- [ ] 分类功能实现
- [ ] 特征提取实现

---

## 7. 附录

### 7.1 术语表
| 术语 | 定义 |
|------|------|
| 集成报表 | 多个数据源合并生成的综合报表 |
| 交付件 | 用户确认的工作成果（报告/集成表等） |
| 合并消息 | 类似微信合并转发的IM消息展示形式 |
| 动态高亮 | 根据选择状态改变按钮可用性 |
